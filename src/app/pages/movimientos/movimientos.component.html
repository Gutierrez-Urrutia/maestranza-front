<div class="page-container">
    <div class="container text-center">
        <div class="row my-3">
            <div class="col-12 my-3">
                <h3>Movimientos de Inventario</h3>
                <p>Gestiona los movimientos de inventario y lleva un control detallado de los productos.</p>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-12 d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-2 text-start">Lista de Movimientos</h2>
                <div>
                    <button class="btn btn-outline-primary me-2">
                        <i class="bi bi-plus-circle me-1"></i>Nuevo Movimiento
                    </button>
                </div>
            </div>
        </div>
        <div class="row">
            <!-- Tabla PrimeNG -->
            <div class="col-12 table-responsive">
                <p-table #dt [value]="movimientos" [paginator]="true" [rows]="10" [showCurrentPageReport]="true"
                    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} movimientos"
                    [rowsPerPageOptions]="[10,25,50]" styleClass="p-datatable-gridlines"
                    [globalFilterFields]="['tipoMovimiento','observacion','usuario.nombre']" responsiveLayout="scroll">

                    <ng-template pTemplate="caption">
                        <div class="row align-items-center">
                            <div class="col-12">
                                <div class="position-relative">
                                    <i
                                        class="bi bi-search position-absolute top-50 start-0 translate-middle-y ms-3 text-muted"></i>
                                    <input pInputText type="text"
                                        (input)="dt.filterGlobal($any($event.target).value, 'contains')"
                                        placeholder="Buscar movimientos..." class="form-control ps-5" />
                                </div>
                            </div>
                        </div>
                    </ng-template>

                    <ng-template pTemplate="header">
                        <tr>
                            <th pSortableColumn="producto.nombre">
                                Producto
                                <p-sortIcon field="producto.nombre"></p-sortIcon>
                            </th>
                            <th pSortableColumn="tipoMovimiento">
                                Tipo
                                <p-sortIcon field="tipoMovimiento"></p-sortIcon>
                            </th>
                            <th pSortableColumn="cantidad">
                                Cantidad
                                <p-sortIcon field="cantidad"></p-sortIcon>
                            </th>
                            <th pSortableColumn="fechaMovimiento">
                                Fecha
                                <p-sortIcon field="fechaMovimiento"></p-sortIcon>
                            </th>
                            <th pSortableColumn="observacion">
                                Observación
                                <p-sortIcon field="observacion"></p-sortIcon>
                            </th>
                            <th pSortableColumn="usuario.nombre">
                                Usuario
                                <p-sortIcon field="usuario.nombre"></p-sortIcon>
                            </th>
                            <th>Acciones</th>
                        </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-movimiento>
                        <tr>
                            <td>
                                <div>
                                    <strong>{{movimiento.producto?.nombre}}</strong>
                                    <br>
                                    <small class="text-muted">Serie: {{movimiento.producto?.serie}}</small>
                                </div>
                            </td>
                            <td>
                                <p-tag [value]="movimiento.tipoMovimiento"
                                    [severity]="getTipoSeverity(movimiento.tipoMovimiento)">
                                    <i class="bi {{getTipoIcon(movimiento.tipoMovimiento)}} me-2"></i>
                                </p-tag>
                            </td>
                            <td class="text-center">
                                <span class="badge"
                                    [class]="movimiento.tipoMovimiento === 'Entrada' ? 'bg-success' : 'bg-danger'">
                                    {{movimiento.tipoMovimiento === 'Entrada' ? '+' : '-'}}{{movimiento.cantidad}}
                                </span>
                            </td>
                            <td>{{movimiento.fechaMovimiento | date:'dd/MM/yyyy HH:mm'}}</td>
                            <td>
                                <span class="text-truncate d-inline-block" style="max-width: 200px;"
                                    [title]="movimiento.observacion">
                                    {{movimiento.observacion}}
                                </span>
                            </td>
                            <td>{{movimiento.usuario?.nombre}}</td>
                            <td class="text-center">
                                <button class="btn btn-sm btn-outline-info me-2" title="Ver detalles">
                                    <i class="bi bi-eye"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-warning" title="Editar movimiento">
                                    <i class="bi bi-pencil-square"></i>
                                </button>
                            </td>
                        </tr>
                    </ng-template>

                    <!-- Actualizar el colspan en la sección empty -->
                    <ng-template pTemplate="empty">
                        <tr>
                            <td colspan="7" class="text-center">
                                <div class="text-muted py-4">
                                    <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                                    <p class="mb-0">No se encontraron movimientos</p>
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
    <app-footer></app-footer>
</div>